# SimpleTextReader-enhance - 易笺﹒改

个人需求定制版。

将原先在 [SimpleTextReaderServer](../SimpleTextReaderServer/) 上的增强功能合并到源项目上，不想再累死累活的打补丁了，还是直接改源码爽啊 :-D

## v1.0.0

最终还是选择了尽量不改动源码 :-P

全部新增功能基本都在另外的代码文件中实现，只对 index.html 和某些 css 做了些小改动，以便插入新增功能。

* [+] 界面参数设置

  可设置参数包括：正文行高，正文字号，日间字符色 & 背景色，夜间字符色 & 背景色，分页条与底部距离，分页条透明度

* [+] 本地缓存书架：缓存打开过的小说

  将打开过的小说保存在浏览器本地缓存数据库中，以后可以直接打开阅读，不再需要原小说文件。

* [+] WebDAV 端小说阅读

  可以列出 WebDAV 服务器上的小说，并打开阅读。

* [+] WebDAV 端阅读进度保存

  可以将阅读进度保存到 WebDAV 服务器上。

> 两个 WebDAV 相关的功能需要把 SimpleTextReader 也部署在同一个 WebDAV 上，让 WebDAV 同时也担当 HTTP Server。

## v1.1.0

* [+] 在设置里为各个增强功能增加开关。

* [+] 本地缓存书架：替换 DropZone 界面（开始界面）。

* [+] 启动时打开上次阅读书籍：只从本地缓存书架中打开。

* [*] 修改了 `/scripts/utility.js` 中的 `setHistory()` `getHistory()`

  将 LocalStorage 中保存的阅读进度的格式改为 `当前行/总行数`，这样就可以在书架界面显示进度。

## v1.2.0

* [*] 用 fetch() 改写 WebDAV.js

* [*] 参数配置中增加了云端书库和云端进度的 WebDAV 地址。

  可以设置不同的 WebDAV 服务器地址，但是能不能连上就不知道了，我只在自己搭建的 WebDAV 上测试过了 :-P

> 【碎碎念】 其实想了想，云端书库好像并没什么大用，WebDAV 直接可以挂成本地硬盘的，和本地文件一样拖进去就好。
> 
> 倒是云端进度还有点用，毕竟 JS 还是不能直接写本地文件的，自然也写不到本地挂载的 WebDAV 硬盘上 ;-) 而不同电脑和浏览器里的进度可以同步这点，本人还是有点小需求的。
>
> 缓存书架也有点用，只要看过，下次就不用再到处重新找文件了。
>
> 嗯，接下来看看 PWA 和扩展的适配问题吧，再后面想试试移动端适配。就是不知道会不会……嗯，从开工到放弃这套我很熟练的 :-D)

## v1.2.1

* [*] 思来想去，还是把 handleSelectedFile() 给改了，增加了 before 和 after 的回调接口，嗯，这下不用 hack 了。

* [*] 把 `文件保存至缓存` 和 `读取云端进度` 改为用新增加的回调接口。

* [+] 增加“手动同步进度”功能，一次同步所有进度（`本地->云端` 或者 `云端->本地`）。

## v1.3.0

**从这个版本开始，与主版本分离了，对原版的页面和脚本开始有较大的改动。**

* [*] 改写 Settings 模块及相关

* [*] 重新安排页面布局和改写相关函数

* [+] 增加“键盘操作 TOC 并跳转”的功能，Shift + Home/End/PgUp/PgDn/Up/Down/Space

  > 顺带发现 Chrome/Edge 的平滑滚动居然是要开的，而且不在 setting 里！`chrome://flags/#smooth-scrolling`

* [+] 增加“浏览器缓存空间用量提示”

* [+] 增加“保存到书架失败（缓存空间已满）判断”

* [+] 书架书籍增加显示“数据文件大小”信息

* [*] 书籍正文框居中

## v1.3.1

* [+] 增加：页面到顶或到底时，若继续向上或向下（PgUp/PgDn/Up/Down/WheelUp/WheelDn）则自动翻页

## v1.3.2

* [*] 适配 Firefox / Chrome / Edge 插件正常界面版

* [*] 由于插件环境下 eval() 受限，将原先 hack 的代码改为直接修改源代码，或采用替代方式实现功能

* [!] bugfix

## v1.3.3

* [-] 取消右侧“书架”按钮

* [*] 界面微调

* [*] 清理 console.log

* [!] bugfix

## v1.4.0

* [+] 云端书库支持多级目录

* [*] 扉页（书名、作者、藏书签）单独作为第一页，正文从第二页开始

* [*] 章节标题识别增加“外传 ...”

## v1.4.1

* [!] bugfix: SettingNumber/SettingInt 无法输入 0

## v1.4.2

* [!] bugfix: 扉页单独一页后，总页数计算有误，导致末页缺失

* [*] 章节标题识别增加“[...]”、“写作杂谈”

* [*] 删除缓存书籍时，不再刷新整个书架，并增加简单的删除动画效果

* [*] 缓存书架书籍封面模仿了 henryxrl 的风格和效果（下次把他的抄过来 :-D）
