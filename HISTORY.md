## v1.6.0-wip

* [*] 微调 css

* [+] 增加界面设置参数：正文显示宽度

* [*] 将 `enhance.js`/`enhance-db.js` 按功能重新分成几个 js 文件

* [-] 移除了 浏览器插件、PWA 相关代码

* [-] 移除了字体文件

## v1.5.2

* [+] “全文搜索”增加“向前搜索”

* [*] 书籍封面上进度显示改为黄铜书签样式

* [+] “书籍”排版模式下，书末增加一行“结束行”

  末行可能会被过滤优化为空，不显示，导致阅读进度达不到 100%，因此增加一行“结束行”，并加入 TOC，可以快速跳转。

* [+] 增加书架排序方式：先按照阅读状态（在读，未读，读完）排序，然后按拼音序

* [*] 缩短中文标题识别时章节号后续字符长度

  `regex_rules.js`:

  ```javascript
  var rules_titles = [
    "... {1,50} ..." -> "... {1,20} ..." // 涉及到中文标题的多处
  ]
  ```

* [*] `settings` 相关代码修改

* [*] 根据行号定位章节的算法改用二分法查找

  这个查找运算非常频繁：因为在页面滚动时会不停调用 `GetScrollPositions()`，每次都会重新定位章节

* [+] 恢复 v1.5.0 增加“流模式”时去除的 v1.3.1 的自动翻页功能

  翻页模式“页模式”，在页面到达顶部/底部后，继续向上/向下，自动翻页

  > 这和“流模式”有些类似，不过，在翻页时阅读视线还是会不连续，需要从最下方移到最上方（或相反）。

* [!] bugfix: `navigator.storage` 只在 HTTPS 和 localhost 可用，其他环境下会抛出异常导致后续脚本不执行，比较明显的现象就是配置里“云端进度”和“云端书库”的配置项消失

  调用前增加判断 `navigator.storage` 是否可用，不可用就隐藏“可用空间”信息

## v1.5.1

* [*] 仿照了 henryxrl 的书籍封面 UI

  > 用一种不太优雅的方式实现了封面字体大小自动调整的功能，算了，不纠结了

* [*] 优化了“快捷键帮助”的页面结构和代码

## v1.5.0

* [+] 增加一个阅读翻页模式：流 :-P

  可以一直向下直到结束；取消分页条，不以 page 定位，而是以 章节 和 全书比例 来定位。

  > 主要遇到的问题：预加载内容时，content 控件内容增减变化，导致定位错乱，特别是正好遇上连续的滚动时，可能会突然跳一大段
  >
  > 目前“流”模式似乎达到正常可用的效果了，暂时没发现啥大问题，就先这样吧
  >
  > ε=ε=ε=┏(゜ロ゜;)┛

* [+] 增加右侧竖向进度条，可直接拖动按比例跳转

  分页模式下是页内进度跳转，流模式下是全书进度跳转。

* [+] 一次拖入多个文件直接加入书架

* [+] 显示行号：在左侧显示行号，并可通过参数开关

* [+] 快速跳转：按 `<g>` 可以输入行号或者百分比跳转

* [+] 全文搜索：按 `<f>` 可以搜索词语（从当前位置开始），支持正则表达式

* [+] 增加“日志模式”：没有TOC，直接显示行号和内容，不做任何过滤、替换

* [+] 按文件名自动选择模式：书籍模式，日志模式

* [*] 调整UI：菜单按钮位置、样式，正文框背景色，进度信息位置，快捷键文字位置，默认配色

* [!] bugfix: `regex_rules.js` 中会把 `bookAndAuthor.bookName` 和 `bookAndAuthor.author` 也加入正则中，如果正好包含了不成对的 `()`，会导致正则表达式错误。

  在 `getBookNameAndAuthor()` 返回的 `bookAndAuthor` 中额外提供 `bookNameRE` 和 `authorRE`，在每个字前插一个 `\`，`regex_rules.js` 换用这两个属性。

  举例：Black Coffee (play novelisation by Charles Osborne)(1997) by Agatha Christie.txt

  > 感谢阿婆！随手选了本阿婆的书就发现了一个 bug ^o^y

  > 这样打补丁之后，书名和作者名的识别还是错的，等想想怎么再修正吧。

* [*] 由于上条 bug，顺便把 `getBookNameAndAuthor()` 改成了用最后的 ` by ` 和 `作者：` 来分割书名、作者

## v1.4.2

* [!] bugfix: 扉页单独一页后，总页数计算有误，导致末页缺失

* [*] 章节标题识别增加“[...]”、“写作杂谈”

* [*] 删除缓存书籍时，不再刷新整个书架，并增加简单的删除动画效果

* [*] 缓存书架书籍封面模仿了 henryxrl 的风格和效果（下次把他的抄过来 :-D）

## v1.4.1

* [!] bugfix: SettingNumber/SettingInt 无法输入 0

## v1.4.0

* [+] 云端书库支持多级目录

* [*] 扉页（书名、作者、藏书签）单独作为第一页，正文从第二页开始

* [*] 章节标题识别增加“外传 ...”

## v1.3.3

* [-] 取消右侧“书架”按钮

* [*] 界面微调

* [*] 清理 console.log

* [!] bugfix

## v1.3.2

* [*] 适配 Firefox / Chrome / Edge 插件正常界面版

* [*] 由于插件环境下 eval() 受限，将原先 hack 的代码改为直接修改源代码，或采用替代方式实现功能

* [!] bugfix

## v1.3.1

* [+] 增加：页面到顶或到底时，若继续向上或向下（PgUp/PgDn/Up/Down/WheelUp/WheelDn）则自动翻页

## v1.3.0

**从这个版本开始，与主版本分离了，对原版的页面和脚本开始有较大的改动。**

* [*] 改写 Settings 模块及相关

* [*] 重新安排页面布局和改写相关函数

* [+] 增加“键盘操作 TOC 并跳转”的功能，Shift + Home/End/PgUp/PgDn/Up/Down/Space

  > 顺带发现 Chrome/Edge 的平滑滚动居然是要开的，而且不在 setting 里！`chrome://flags/#smooth-scrolling`

* [+] 增加“浏览器缓存空间用量提示”

* [+] 增加“保存到书架失败（缓存空间已满）判断”

* [+] 书架书籍增加显示“数据文件大小”信息

* [*] 书籍正文框居中

## v1.2.1

* [*] 思来想去，还是把 handleSelectedFile() 给改了，增加了 before 和 after 的回调接口，嗯，这下不用 hack 了。

* [*] 把 `文件保存至缓存` 和 `读取云端进度` 改为用新增加的回调接口。

* [+] 增加“手动同步进度”功能，一次同步所有进度（`本地->云端` 或者 `云端->本地`）。

## v1.2.0

* [*] 用 fetch() 改写 WebDAV.js

* [*] 参数配置中增加了云端书库和云端进度的 WebDAV 地址。

  可以设置不同的 WebDAV 服务器地址，但是能不能连上就不知道了，我只在自己搭建的 WebDAV 上测试过了 :-P

> 【碎碎念】 其实想了想，云端书库好像并没什么大用，WebDAV 直接可以挂成本地硬盘的，和本地文件一样拖进去就好。
> 
> 倒是云端进度还有点用，毕竟 JS 还是不能直接写本地文件的，自然也写不到本地挂载的 WebDAV 硬盘上 ;-) 而不同电脑和浏览器里的进度可以同步这点，本人还是有点小需求的。
>
> 缓存书架也有点用，只要看过，下次就不用再到处重新找文件了。
>
> 嗯，接下来看看 PWA 和扩展的适配问题吧，再后面想试试移动端适配。就是不知道会不会……嗯，从开工到放弃这套我很熟练的 :-D)

## v1.1.0

* [+] 在设置里为各个增强功能增加开关。

* [+] 本地缓存书架：替换 DropZone 界面（开始界面）。

* [+] 启动时打开上次阅读书籍：只从本地缓存书架中打开。

* [*] 修改了 `/scripts/utility.js` 中的 `setHistory()` `getHistory()`

  将 LocalStorage 中保存的阅读进度的格式改为 `当前行/总行数`，这样就可以在书架界面显示进度。

## v1.0.0

最终还是选择了尽量不改动源码 :-P

全部新增功能基本都在另外的代码文件中实现，只对 index.html 和某些 css 做了些小改动，以便插入新增功能。

* [+] 界面参数设置

  可设置参数包括：正文行高，正文字号，日间字符色 & 背景色，夜间字符色 & 背景色，分页条与底部距离，分页条透明度

* [+] 本地缓存书架：缓存打开过的小说

  将打开过的小说保存在浏览器本地缓存数据库中，以后可以直接打开阅读，不再需要原小说文件。

* [+] WebDAV 端小说阅读

  可以列出 WebDAV 服务器上的小说，并打开阅读。

* [+] WebDAV 端阅读进度保存

  可以将阅读进度保存到 WebDAV 服务器上。

> 两个 WebDAV 相关的功能需要把 SimpleTextReader 也部署在同一个 WebDAV 上，让 WebDAV 同时也担当 HTTP Server。
